---
interface Props {
  activeTab?: 'weekly' | 'gossip' | 'window';
}

const { activeTab = 'weekly' } = Astro.props;
---

<div id="fixed-tabs" class="fixed top-0 left-0 right-0 z-50 bg-white/60 dark:bg-base-950/80 backdrop-blur-2xl border-b border-base-100 dark:border-base-800 py-3 px-4 opacity-0 -translate-y-full transition-all duration-300 pointer-events-none">
  <ul class="flex justify-between w-full max-w-3xl mx-auto gap-2">
    <li data-tab="weekly" data-fixed="true" class={`cursor-pointer text-sm sm:text-lg transition-colors duration-200 ${activeTab === 'weekly' ? 'text-base-900 dark:text-white' : 'font-light font-display text-slate-700 dark:text-zinc-400'}`}>
      <div class="font-nouvelr-semibold">Həftəbécər</div>
    </li>
    <li data-tab="gossip" data-fixed="true" class={`cursor-pointer text-sm sm:text-lg transition-colors duration-200 ${activeTab === 'gossip' ? 'text-base-900 dark:text-white' : 'font-light font-display text-slate-700 dark:text-zinc-400'}`}>
      <div class="font-nouvelr-semibold">Dédi-qodu</div>
    </li>
    <li data-tab="window" data-fixed="true" class={`cursor-pointer text-sm sm:text-lg transition-colors duration-200 ${activeTab === 'window' ? 'text-base-900 dark:text-white' : 'font-light font-display text-slate-700 dark:text-zinc-400'}`}>
      <div class="font-nouvelr-semibold">Pəncərələr</div>
    </li>
  </ul>
</div>

<script>
  import { navigate } from 'astro:transitions/client';

  document.addEventListener('astro:page-load', () => {
    const mainTabs = document.getElementById('main-tabs');
    const fixedTabs = document.getElementById('fixed-tabs');
    const fixedTabItems = document.querySelectorAll('[data-tab][data-fixed]');
    
    if (!mainTabs || !fixedTabs) return;

    // Aktif tab-ı tap
    let activeTabId = 'weekly';
    const currentPath = window.location.pathname;
    if (currentPath === '/shares') {
      activeTabId = 'gossip';
    } else if (currentPath === '/windows') {
      activeTabId = 'window';
    }

    // Scroll handler - fixed tabs göstər/gizlət
    let scrollTicking = false;

    const handleScroll = () => {
      const mainTabsRect = mainTabs.getBoundingClientRect();
      const shouldShowFixed = mainTabsRect.bottom < 0;

      if (shouldShowFixed) {
        fixedTabs.classList.remove('opacity-0', '-translate-y-full', 'pointer-events-none');
        fixedTabs.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
      } else {
        fixedTabs.classList.add('opacity-0', '-translate-y-full', 'pointer-events-none');
        fixedTabs.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
      }

      scrollTicking = false;
    };

    const requestScrollUpdate = () => {
      if (!scrollTicking) {
        window.requestAnimationFrame(handleScroll);
        scrollTicking = true;
      }
    };

    window.addEventListener('scroll', requestScrollUpdate, { passive: true });

    // Tab click handler
    const handleTabClick = (tabId: string) => {
      let url = '/';
      if (tabId === 'gossip') {
        url = '/shares';
      } else if (tabId === 'window') {
        url = '/windows';
      }
      navigate(url);
    };

    // Hover handler
    const handleHover = (hoveredTabId: string) => {
      fixedTabItems.forEach(t => {
        if (t.getAttribute('data-tab') === hoveredTabId) {
          t.classList.remove('text-slate-700', 'font-light', 'font-display', 'dark:text-zinc-400');
          t.classList.add('text-base-900', 'dark:text-white');
        } else {
          t.classList.add('text-slate-700', 'font-light', 'font-display', 'dark:text-zinc-400');
          t.classList.remove('text-base-900', 'dark:text-white');
        }
      });
    };

    // Mouseleave handler
    const handleMouseLeave = () => {
      fixedTabItems.forEach(t => {
        const tabId = t.getAttribute('data-tab');
        if (tabId === activeTabId) {
          t.classList.remove('text-slate-700', 'font-light', 'font-display', 'dark:text-zinc-400');
          t.classList.add('text-base-900', 'dark:text-white');
        } else {
          t.classList.add('text-slate-700', 'font-light', 'font-display', 'dark:text-zinc-400');
          t.classList.remove('text-base-900', 'dark:text-white');
        }
      });
    };

    // Event listeners
    fixedTabItems.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        if (tabId) handleTabClick(tabId);
      });

      tab.addEventListener('mouseenter', () => {
        const tabId = tab.getAttribute('data-tab');
        if (tabId) handleHover(tabId);
      });

      tab.addEventListener('mouseleave', handleMouseLeave);
    });
  });
</script>
