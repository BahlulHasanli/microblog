---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Editor from '../components/Editor';

import { isAuthenticated, getUserFromCookies } from "@/utils/auth";

const isLoggedIn = isAuthenticated(Astro.cookies);

if (!isLoggedIn) {
  return Astro.redirect("/");
}

const user = await getUserFromCookies(Astro.cookies, Astro.redirect);

if (!user) return Astro.redirect("/");

// Yalnız Admin (1), Moderator (2) və Editor (3) rolları yazı yaza bilər
const canWrite = user.role_id === 1 || user.role_id === 2 || user.role_id === 3;
if (!canWrite) {
  return Astro.redirect("/");
}
---

<BaseLayout 
  title="Studio"
  description="The 99 redaksiyasında yeni məzmun yaradın. Məqalə, post və xəbər yazıb yayımlayın."
>
  <Editor author={user} client:visible />
</BaseLayout>

<style>
  @import "../styles/_variables.scss";
  @import "../styles/_keyframe-animations.scss";
</style>
