---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { supabase } from "@/db/supabase";
import ShareDetail from "@/components/shares/ShareDetail.svelte";

const { id } = Astro.params;

if (!id) {
  return Astro.redirect("/");
}

// Fetch share with user info
const { data: share, error } = await supabase
  .from("shares")
  .select("*, user_id(*), share_likes(id, user_id)")
  .eq("id", id)
  .single();

if (error || !share) {
  console.error("Share fetch error:", error);
  return Astro.redirect("/");
}

// Fetch comments for this share
const { data: comments } = await supabase
  .from("share_comments")
  .select("*, user_id(id, fullname, username, avatar)")
  .eq("share_id", id)
  .order("created_at", { ascending: true });
---

<BaseLayout>
  <div class="max-w-3xl mx-auto px-4 sm:px-0 py-6 sm:py-8">
    <ShareDetail client:load share={share} comments={comments || []} />
  </div>
</BaseLayout>
